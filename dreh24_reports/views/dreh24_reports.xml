<?xml version="1.0" encoding="utf-8"?>
<openerp>
  <data>
    <template 
      id="report_saleorder_dreh24" inherit_id="sale.report_saleorder_document">
      <xpath expr="//div[@class='page']" position="replace">
        <div class="page">
          <t t-call="report.external_report_info"/>
          
          <div class="vspace-xs clearleft left" id="addressee">
            <div t-if="not o.partner_invoice_id.is_company" 
              t-field="o.partner_invoice_id.parent_id.name"/> 
            <div t-field="o.partner_invoice_id.name"/>
            <div t-field="o.partner_invoice_id.street"/>
            <div t-if="o.partner_invoice_id.street2"
              t-field="o.partner_invoice_id.street2"/>
            <p/>
            <span class="vspace-s" t-field="o.partner_invoice_id.zip"/>
            <span t-field="o.partner_invoice_id.city"/> / <span t-field="o.partner_invoice_id.country_id.name"/>
          </div>
 
          <!-- shipping address != invoice address -->
          <div t-if="o.state not in ['draft','sent']" 
            class="right vspace-xs"
            id="delivery"
            style="max-width:7cm;">
              <p>Lieferadresse:</p>
              <div t-field="o.partner_shipping_id.name"/>
              <div t-field="o.partner_shipping_id.street"/>
              <div t-if="o.partner_shipping_id.stree2"
                t-field="o.partner_shipping_id.street2"/>
              <span t-field="o.partner_shipping_id.zip"/>
              <span t-field="o.partner_shipping_id.city"/> / 
              <span t-field="o.partner_shipping_id.country_id.name"/>
          </div>
 
          <div class="fullwidth" style="padding-top:1cm;clear:left">
            <span class="title hspace-s"
              t-if="o.state not in ['draft','sent'] or o.payment_acquirer_id">
              Auftragsbest&amp;auml;tigung Nr.
            </span>
            <span class="title hspace-s"
              t-if="o.state in ['draft','sent'] and not o.payment_acquirer_id">
              Angebot Nr.
            </span>
            <b><span class="title hspace-s" t-field="o.name"/></b>
            <span class="hspace-s"> vom </span>
            <span class="hspace-s" 
              t-esc="datetime.datetime.strptime(o.date_order, '%Y-%m-%d %H:%M:%S').strftime('%d.%m.%Y')"/>
             <t t-call="report.external_report_partner_ref"/>
          </div>
          
          <div class="vspace-xs">
            <span t-if="o.state in ['draft','sent'] and not o.payment_acquirer_id">Ihre Anfrage </span>
            <span t-if="o.state not in ['draft','sent'] or o.payment_acquirer_id">Ihre Bestellung</span>
            <span t-field="o.client_order_ref"/>
            <span t-if="o.client_order_ref_date">
              vom <span t-field="o.client_order_ref_date"/>
            </span>
            <br/>
            <span t-if="o.partner_id.your_ref">
              Lieferanten-Nr. <span t-field="o.partner_id.your_ref"/>
            </span>
          </div>
          
          <div t-if="o.state in ['draft','sent'] and o.company_id.name == 'dreh24 AG' and not o.payment_acquirer_id" 
            class="vspace-xs">
            Wir bedanken uns für Ihre Anfrage und bieten freibleibend,
            ausschließlich zu unseren Liefer- und Zahlungsbedingungen an.
            Diese finden Sie auf unserer Internetseite – www.dreh24.com
          </div>

          <div t-if="o.state in ['draft','sent'] and o.company_id.name != 'dreh24 AG'">
            Wir bedanken uns für Ihre Anfrage und bieten freibleibend an.
          </div>

          <div t-if ="o.payment_acquirer_id" class="vspace-xs">
            Wir bedanken uns für Ihre Bestellung. Die Lieferung erfolgt 
            ausschließlich zu unseren Liefer- und Zahlungsbedingungen. 
            Diese finden Sie auf unserer Internetseite – www.dreh24.com
          </div>

          <table class="fullwidth vspace-s">
            <thead>
              <tr>
                <th>Pos.</th>
                <th>Artikelnr.</th>
                <th>Artikelbezeichnung</th>
                <th>Menge</th>
                <th>Einheit</th>
                <th>Preis/Einheit</th>
                <th class="right">Gesamtpreis</th>
              </tr>
            </thead>
            <tbody class="sale_tbody top">
              <tr t-foreach="o.order_line" t-as="l">
                <td><span t-esc="l_index + 1"/></td>
                <td><span t-field="l.product_id.default_code"/></td>
                <td>
                  <span t-field="l.product_id.name"/>
                  <!-- info über verfügbarkeit -->
                  <t t-if="l.product_id.categ_id.name != 'Versand'">
                    <br/>
                    <!-- Anfrage -->
                    <t t-if="o.state in ['draft','sent']">
                      <span t-if="l.product_id.uom_id.factor * l.product_id.virtual_available &gt;= l.product_uom_qty * l.product_uom.factor">
                        ab Lager lieferbar
                      </span>
                      <span t-if="l.product_id.uom_id.factor * l.product_id.virtual_available &lt; l.product_uom_qty * l.product_uom.factor">
                        Lieferzeit 4 Wochen
                      </span>
                    </t>
                    <!-- Auftragsbestätigung -->
                    <t t-if="not o.state in ['draft','sent']">
                      <!-- auf Lager -->
                      <t t-if="l.product_id.uom_id.factor * l.product_id.virtual_available &gt;= l.product_uom_qty * l.product_uom.factor">
                        voraussichtl. Liefertermin
                        <!-- Expressversand -->
                        <t t-if="o.carrier_id and ('Expressversand' in o.carrier_id.name)">
                          <t t-if="datetime.date.today().isoweekday() in range (1,5)">
                            <span t-esc="(datetime.date.today() + datetime.timedelta(days=1)).strftime('%d.%m.%Y')"/>
                          </t>
                          <t t-if="not datetime.date.today().isoweekday() in range (1,5)">
                            <span t-esc="(datetime.date.today() + datetime.timedelta(days=3)).strftime('%d.%m.%Y')"/>
                          </t>
                        </t>
                        <t t-if="o.carrier_id and (not 'Expressversand' in o.carrier_id.name)">
                          <!-- ohne Wunschtermin -->
                          <t t-if="not o.custom_delivery_date">
                            <span t-esc="(datetime.date.today() + datetime.timedelta(days=l.product_id.sale_delay)).strftime('%d.%m.%Y')"/>
                          </t>
                          <!-- mit Wunschtermin -->
                          <t t-if="o.custom_delivery_date">
                            <span t-field="o.custom_delivery_date"/>
                          </t>
                        </t>
                      </t>
                      <!-- Nicht auf Lager -->
                      <t t-if="l.product_id.uom_id.factor * l.product_id.virtual_available &lt; l.product_uom_qty * l.product_uom.factor">
                        <t t-if="o.company_id.name == 'dreh24 AG'">
                          voraussichtl. Liefertermin<span t-esc="(datetime.date.today() + datetime.timedelta(days=28)).strftime('%d.%m.%Y')"/>
                        </t>
                        <t t-if="o.company_id.name != 'dreh24 AG'">
                          Liefertermin: <span t-field="o.custom_delivery_date"/>
                        </t>
                      </t>
                    </t>
                  </t>
                </td>
                <td><span t-esc="'%d' % l.product_uom_qty"/></td>
                <td><span t-field="l.product_uom"/></td>
                <td><span t-field="l.price_unit"
                    t-field-options='{"widget": "monetary", "display_currency": "o.pricelist_id.currency_id"}'/>
                </td>
                <td class="right">
                  <span t-field="l.price_subtotal"
                    t-field-options='{"widget": "monetary", "display_currency": "o.pricelist_id.currency_id"}'/>
                </td>
              </tr>
            </tbody>
          </table>

          <table id="amount_total" class="right vspace-s">
            <tr>
              <td>Gesamt Netto</td>
              <td class="right">
                <span t-field="o.amount_untaxed"
                  t-field-options='{"widget": "monetary", "display_currency": "o.pricelist_id.currency_id"}'/>
              </td>
            </tr>
            <tr>
              <td>MwSt. 19 %</td>
              <td class="right">
                <span t-field="o.amount_tax"
                  t-field-options='{"widget": "monetary", "display_currency": "o.pricelist_id.currency_id"}'/>
              </td>
            </tr>
            <tr>
              <td>Rechnungsendbetrag</td>
              <td class="right">
                <span t-field="o.amount_total"
                  t-field-options='{"widget": "monetary", "display_currency": "o.pricelist_id.currency_id"}'/>
              </td>
            </tr>
          </table>
          
          <!-- cash discount -->
          <div class="clearleft" t-if="o.payment_term.discount_rate">
            <table>
              <tr>
                <td colspan="3">
                  Zahlung: innerhalb von 
                  <span t-field="o.payment_term.discount_deadline"/> Tagen mit
                  <span t-field="o.payment_term.discount_rate"/> &amp;#037; Skonto,
                  <span t-field="o.payment_term.net_payment_target"/> Tage netto
                </td>
              </tr>
              <tr>
                <td>Zahlung bis <span t-field="o.discount_date"/></td>
                <td class="right">
                  abzgl. <span t-field="o.discount_amount"
                    t-field-options='{"widget": "monetary", "display_currency" : "o.pricelist_id.currency_id"}'/> = 
                </td>
                <td class="right">
                  <span t-field="o.discount_sum"
                    t-field-options='{"widget": "monetary", "display_currency" : "o.pricelist_id.currency_id"}'/> 
                </td>
              </tr>
              <tr>
                <td>
                  Zahlung bis <span t-field="o.net_date"/>
                </td>
                <td class="right">=</td>
                <td class="right">
                  <span t-field="o.amount_total"
                    t-field-options='{"widget": "monetary", "display_currency" : "o.pricelist_id.currency_id"}'/> 
                </td>
              </tr>
            </table>
          </div>

          <!-- Versandart, -bedingungen und Zahlungsbedingungen -->
          <div style="margin-top:2.5cm">
            <p t-if="o.state not in ['draft','sent']">
              <div t-if="o.fiscal_position.name == 'Kunde EU Unternehmen (mit USt-ID)'">
                Die USt-ID Nummer des Empfängers lautet <span t-field="o.partner_invoice_id.vat"/><br/>
                Der Empfänger bestätigt, die Gegenstände für sein Unternehmen erworben zu haben.
              </div>
              <div t-field="o.fiscal_position.note" class="vspace-xs"/>
              <div t-if="not o.payment_acquirer_id" class="vspace-s">
                Die Lieferung erfolgt ausschließlich zu unseren Liefer- und Zahlungsbedingungen. <br/>
                Diese finden Sie auf unserer Internetseite – www.dreh24.com
              </div>
            </p>
            <p t-if="o.company_id.name == 'dreh24 AG' and o.state in ['draft','sent']">
              Zwischenverkauf vorbehalten.
            </p>
            <p t-if="o.payment_acquirer_id.name == 'Vorkasse' and o.state in ['draft','sent']">Überweisen Sie
              den Betrag auf eines unserer Konten. Nach Geldeingang wird die Bestellung bearbeitet.
            </p>
            <p t-if="o.payment_acquirer_id.name == 'Vorkasse' and o.state not in ['draft','sent']">
              Wir haben Ihre Zahlung erhalten und werden Ihre Bestellung bearbeiten.
            </p>
            <p t-if="o.payment_acquirer_id.name == 'PayPal'">Bezahlung erfolgt über PayPal.</p>
            <p t-if="o.carrier_id" class="vspace-xs">Versand: <span t-field="o.carrier_id.name"/></p>
            <p t-if="o.incoterm">Lieferung: <span t-field="o.incoterm.name"/></p>
            <p t-if="o.payment_term">Zahlung: <span t-field="o.payment_term.note"/></p>
            <br/>
            <p t-if="o.note"><span t-field="o.note"/></p>
          </div>
        </div>
      </xpath>      
    </template>

    <!-- invoice -->
    <template id="report_invoice_document_dreh24" 
      inherit_id="account.report_invoice_document">
      <xpath expr="//div[@class='page']" position="replace">
        <div class="page">
          <t t-call="report.external_report_info"/>
         
          <div class="vspace-xs clearleft" id="addressee">
            <div t-if="not o.partner_id.is_company" 
              t-field="o.partner_id.parent_id.name"/> 
            <div t-field="o.partner_id.name"/>
            <p t-field="o.partner_id.street"/>
            <span t-field="o.partner_id.zip"/>
            <span t-field="o.partner_id.city"/> / <span t-field="o.partner_id.country_id.name"/>
          </div>
       
          <div class="fullwidth vspace-l">
            <span class="title hspace-s">
              <span t-if="o.type == 'out_invoice' and (o.state == 'open' or o.state == 'paid')">Rechnung</span>
              <span t-if="o.type == 'out_invoice' and o.state == 'proforma2'">PRO-FORMA Rechnung</span>
              <span t-if="o.type == 'out_invoice' and o.state == 'draft'">Rechnungsentwurf</span>
              <span t-if="o.type == 'out_invoice' and o.state == 'cancel'">Stornierte Rechnung</span>
              <span t-if="o.type == 'out_refund'">Rückzahlung</span>
              <span t-if="o.type == 'in_refund'">Lieferantenrückzahlung</span>
              <span t-if="o.type == 'in_invoice'">Liererantenrechnung</span>
            </span>
            <b><span class="title hspace-m" t-field="o.number"/></b>
            <span t-if="o.date_invoice" class="hspace-s"> vom </span>
            <span class="hspace-m" t-field="o.date_invoice"/>
            <t t-call="report.external_report_partner_ref"/>
          </div>
          
          <div t-if="o.type not in ['in_refund', 'in_invoice']" class="vspace-xs">
            <span>Auftragsnr. </span>
            <span t-if="o.name">
              <span t-field="o.name"/>
              <!--span t-if="o.client_order_ref_date">
                vom <span t-field="o.client_order_ref_date"/>
              </span-->
            </span><br/>
            <span t-if="o.partner_id.your_ref">
              Lieferanten-Nr. <span t-field="o.partner_id.your_ref"/>
            </span>
          </div>

          <table class="fullwidth vspace-s">
            <thead>
              <tr>
                <th>Pos.</th>
                <th>Artikelnr.</th>
                <th>Artikelbezeichnung</th>
                <th>Menge</th>
                <th>Einheit</th>
                <th>Preis/Einheit</th>
                <th class="right">Gesamtpreis</th>
              </tr>
            </thead>
            <tbody class="sale_tbody top">
              <tr t-foreach="o.invoice_line" t-as="l">
                <td><span t-esc="l_index + 1"/></td>
                <td><span t-field="l.product_id.default_code"/></td>
                <td><span t-field="l.product_id.name"/></td>
                <td><span t-esc="'%d' % l.quantity"/></td>
                <td><span t-field="l.uos_id.name"/></td>
                <td><span t-field="l.price_unit"
                    t-field-options='{"widget": "monetary", "display_currency": "o.currency_id"}'/>
                </td>
                <td class="right">
                  <span t-field="l.price_subtotal"
                    t-field-options='{"widget": "monetary", "display_currency": "o.currency_id"}'/>
                </td>
              </tr>
            </tbody>
          </table>

          <table id="total" class="right vspace-s">
            <tr>
              <td>Gesamt Netto</td>
              <td class="right">
                <span t-field="o.amount_untaxed"
                  t-field-options='{"widget": "monetary", "display_currency": "o.currency_id"}'/>
              </td>
            </tr>
            <tr>
              <td>MwSt. 19 %</td>
              <td class="right">
                <span t-field="o.amount_tax"
                  t-field-options='{"widget": "monetary", "display_currency": "o.currency_id"}'/>
              </td>
            </tr>
            <tr>
              <td>Rechnungsendbetrag</td>
              <td class="right">
                <span t-field="o.amount_total"
                  t-field-options='{"widget": "monetary", "display_currency": "o.currency_id"}'/>
              </td>
            </tr>
          </table>

          <!-- Anmerkung -->
          <div style="margin-top:2.5cm">
            <div t-if="o.fiscal_position.name == 'Kunde EU Unternehmen (mit USt-ID)'">
              Die USt-ID Nummer des Empfängers lautet <span t-field="o.partner_id.vat"/><br/>
              Der Empfänger bestätigt, die Gegenstände für sein Unternehmen erworben zu haben.
            </div>
            <div t-field="o.fiscal_position.note" class="vspace-xs"/>
            <div class="vspace-s">
              Die gelieferte Ware bleibt bis zur vollständigen Bezahlung Eigentum des Lieferanten.<br/>
              <div t-if="o.company_id.name == 'dreh24 AG'">
                Die Lieferung erfolgt ausschließlich zu unseren Liefer- und Zahlungsbedingungen.
                Diese finden Sie auf unserer Internetseite – www.dreh24.com<br/>
              </div>
              Wenn kein abweichendes Lieferdatum, dann gilt Rechnungsdatum gleich Lieferdatum.
            </div>
          </div>
            
          <!-- Versandart, -bedingungen und Zahlungsbedingungen -->
          <div class="vspace-s" t-if="o.payment_term.discount_rate == 0.0">
            Zahlungsbedinungen: <span t-field="o.payment_term.note"/>
          </div>
          <div class="vspace-xs" t-field="o.comment"/>
        </div>
       </xpath>      
    </template>

    <!-- delivery slip -->
    <!-- deliver.report_shipping2 muss gelöscht werden!!! -->
    <template id="report_picking" inherit_id="stock.report_picking">
      <xpath expr="//div[@class='page']" position="replace">
        <div class="page">
          <t t-call="report.external_report_info"/>
          <t t-call="report.external_report_to"/>
       
          <div class="fullwidth vspace-l">
            <span class="title hspace-s">Lieferschein</span>
            <b><span class="title hspace-m" t-field="o.name"/></b>
            <span class="hspace-s"> vom </span>
            <span class="hspace-m" t-esc="datetime.datetime.strptime(o.date, '%Y-%m-%d %H:%M:%S').strftime('%d.%m.%Y')"/>
            <t t-call="report.external_report_partner_ref"/>
          </div>

          <div class="vspace-xs">
            Auftragsnr. <span t-field="o.client_order_ref"/>
          </div>

          <table class="fullwidth vspace-m">
            <thead>
              <tr>
                <th>Pos.</th>
                <th>Artikelnr.</th>
                <th>Artikelbezeichnung</th>
                <th>Einheit</th>
                <th>Menge</th>
              </tr>
            </thead>
            <tbody>
              <tr t-foreach="o.move_lines" t-as="move">
                <td class="top"><span t-esc="move_index + 1"/></td>
                <td class="top"><span t-field="move.product_id.default_code"/></td>
                <td class="top"><span t-field="move.product_id.name"/></td>
                <td class="top"><span t-field="move.product_uom.name"/></td>
                <td class="top"><span t-esc="'%d' % move.product_uom_qty"/></td>
              </tr>
            </tbody>
          </table>

          <div class="vspace-m">
            Die gelieferte Ware bleibt bis zur vollständigen Bezahlung Eigentum des Lieferanten.<br/>
            <div t-if="o.company_id.name == 'dreh24 AG'">
              Die Lieferung erfolgt ausschließlich zu unseren Liefer- und Zahlungsbedingungen. <br/>
              Diese finden Sie auf unserer Internetseite – www.dreh24.com
            </div>
          </div>
          <div t-if="o.partner_id.name[0] == 'B' and o.partner_id.name[2:] == 'rkert'" class="vspace-s">
            Die Artikel sind RoHS konform.
          </div>
          <div t-if="o.weight != 0.0" class="vspace-s">
            <strong>Gesamtgewicht: </strong>
            <span t-field="o.weight"/> <span t-field="o.weight_uom_id.name"/>
          </div>
           <!-- Wurde bebraucht für report_shipping2-->
           <div name="partner_header"/>
           <table>
                <tr><th name="td_sched_date_h"></th></tr>
                <tr><td name="td_sched_date"></td></tr>
           </table>
        </div>
      </xpath>
    </template>

    <!-- Anfrage -->
    <template id="report_purchasequotation"
      inherit_id="purchase.report_purchasequotation">
      <xpath expr="//div[@class='page']" position="replace">
        <div class="page">
          <t t-call="report.external_report_info"/>
          <t t-call="report.external_report_to"/>
          
          <div class="vspace-s"><b>Lieferadresse:</b></div>
          <div t-if="o.dest_address_id" class="vspace-xs">
            <div t-field="o.dest_address_id" 
                 t-field-options='{"widget": "contact", "fields": ["address", "name"], "no_marker": true}'/>
          </div>
          <div t-if="o.picking_type_id.warehouse_id" class="vspace-xs">
            <span t-field="o.picking_type_id.warehouse_id.name"/>
            <div t-field="o.picking_type_id.warehouse_id.partner_id"
              t-field-options='{"widget": "contact", "fields": ["address", "name"], "no_marker": true}'/>
          </div>

          <div class="fullwidth vspace-l">
            <span class="title hspace-s">Anfrage</span>
            <b><span class="title hspace-m" t-field="o.name"/></b>
            <span class="hspace-s"> vom </span>
            <span class="hspace-m" t-esc="datetime.datetime.strptime(o.date_order, '%Y-%m-%d %H:%M:%S').strftime('%d.%m.%Y')"/>
            <t t-call="report.external_report_partner_ref"/>
          </div>

          <p t-if="o.notes" class="vspace-m" t-field="o.notes"/>

          <table class="fullwidth vspace-m">
            <thead>
              <tr>
                <th>Pos.</th>
                <th>Artikelbezeichnung</th>
                <th>Menge</th>
              </tr>
            </thead>
            <tbody>
              <tr t-foreach="o.order_line" t-as="order">
                <td class="top"><span t-esc="order_index + 1"/></td>
                <td class="top"><span t-field="order.product_id.name"/></td>
                <td class="top"><span t-field="order.product_qty"/></td>
              </tr>
            </tbody>
          </table>
          <p class="vspace-m">Wir bitten um ein unverbindliches Angebot.</p>
        </div>
      </xpath>
    </template>

    <!-- Bestellung -->
    <template id="report_purchaseorder" inherit_id="purchase.report_purchaseorder">
      <xpath expr="//div[@class='page']" position="replace">
        <div class="page">
          <t t-call="report.external_report_info"/>
          <t t-call="report.external_report_to"/>
          
          <div class="vspace-s">Lieferadresse:</div>
          <div t-if="o.dest_address_id" class="vspace-xs">
            <div t-field="o.dest_address_id" 
                 t-field-options='{"widget": "contact", "fields": ["address", "name"], "no_marker": true}'/>
          </div>
          <div t-if="o.picking_type_id.warehouse_id" class="vspace-xs">
            <span t-field="o.picking_type_id.warehouse_id.name"/>
            <div t-field="o.picking_type_id.warehouse_id.partner_id"
              t-field-options='{"widget": "contact", "fields": ["address", "name"], "no_marker": true}'/>
          </div>

          <div class="fullwidth vspace-l">
            <span class="title hspace-s">Bestellung</span>
            <b><span class="title hspace-m" t-field="o.name"/></b>
            <span class="hspace-s"> vom </span>
            <span class="hspace-m" t-esc="datetime.datetime.strptime(o.date_order, '%Y-%m-%d %H:%M:%S').strftime('%d.%m.%Y')"/>
            <t t-call="report.external_report_partner_ref"/>
          </div>

          <p t-if="o.notes" class="vspace-m" t-field="o.notes"/>

          <table class="fullwidth vspace-m">
            <thead>
              <tr>
                <th>Pos.</th>
                <th>Artikelbezeichnung</th>
                <th>Menge</th>
              </tr>
            </thead>
            <tbody>
              <tr t-foreach="o.order_line" t-as="order">
                <td class="top"><span t-esc="order_index + 1"/></td>
                <td class="top"><span t-field="order.product_id.name"/></td>
                <td class="top"><span t-field="order.product_qty"/></td>
              </tr>
            </tbody>
          </table>
          <p t-if="o.company_id.name == 'dreh24 AG'" class="vspace-m">
            Wir bestellen unter Zugrundelegung unserer Einkaufsbedingungen
            abrufbar unter www.dreh24.com die oben aufgeführten Waren bzw.
            Dienstleistungen.
          </p>
          <p t-if="'Weippert Kunststofftechnik GmbH' in o.company_id.name" class="vspace-m">
            Wir bestellen unter Zugrundelegung unserer Einkaufsbedingungen
            abrufbar unter www.weippert-technik.de die oben aufgeführten Waren bzw.
            Dienstleistungen.
          </p>
        </div>
      </xpath>
    </template>
  </data>
</openerp>
